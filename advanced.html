
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Topics &#8212; sci-wms 2.0.0-dev documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Roadmap" href="roadmap.html" />
    <link rel="prev" title="Deployment" href="deployment.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="roadmap.html" title="Roadmap"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">sci-wms 2.0.0-dev documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-topics">
<h1>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="virtual-layers">
<h2>Virtual layers<a class="headerlink" href="#virtual-layers" title="Permalink to this headline">¶</a></h2>
<p><strong>Virtual Layers</strong> allow you to use a parameter expression to access multiple variables from a dataset in a special way, while specifying a descriptive layer name that will also appear in the <em>GetCapabilities</em> documents. This is so that generic web clients don’t necessarility need to know the intracacies of assembling <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> parameter expressions in requests.</p>
<p>Suported parameter expressions:</p>
<p><code class="docutils literal notranslate"><span class="pre">[layer_1],[layer_2]</span></code> This will treat layer_1 as a U vector and layer_2 as a V vector and produce vector plots.</p>
</div>
<div class="section" id="topology-cache">
<span id="id1"></span><h2>Topology Cache<a class="headerlink" href="#topology-cache" title="Permalink to this headline">¶</a></h2>
<p>The topology cache is an important optimization that speeds up response times for datasets that are accessed over opendap. The cache is current located in the folder of the <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> instance at <code class="docutils literal notranslate"><span class="pre">path/to/sci-wms/wms/topology</span></code>. There are a number of files that make up the cache, and they vary by dataset type.</p>
<p>Each file has a name that is taken directly from the <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> <strong>Dataset</strong>’s <strong>‘Name’</strong>.</p>
<div class="section" id="spatial-tree-idx-and-dat">
<h3>Spatial Tree (.idx and .dat)<a class="headerlink" href="#spatial-tree-idx-and-dat" title="Permalink to this headline">¶</a></h3>
<p>These files contain serialized <em>RTree</em> spatial objects that are used for quickly making nearest neighbor queries as part of GetFeatureInfo requests.</p>
<p>These are necessary for large unstructured meshes, but are also used for the logically rectangular grids as well.  Ideally it would be nice to move away from <em>RTree</em> into a better KD-Tree implementation, like <em>sklearn</em>’s, that will have better on disk performance lookup performance, but will be slower to initially build.</p>
<p>These files are constructed once when the dataset is added and not updated unless an <code class="docutils literal notranslate"><span class="pre">Update</span> <span class="pre">Dataset</span></code> request is triggered via the <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> admin page or API. If a dataset is set to <code class="docutils literal notranslate"><span class="pre">Keep</span> <span class="pre">up</span> <span class="pre">to</span> <span class="pre">date</span></code> then it will update this cache every X seconds, depending on what the dataset is configured for.</p>
<p>Adding a new dataset through the website when running in <a class="reference internal" href="deployment.html#quickstart-run"><span class="std std-ref">Quickstart</span></a> mode may timeout due to the topology cache taking along time to complete. If you run across this case, it is better to add the Dataset manually through the command line (no documentation at this point) or to use the <a class="reference internal" href="deployment.html#advanced-run"><span class="std std-ref">Advanced</span></a> mode of running <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code>.</p>
</div>
<div class="section" id="netcdf-nc">
<h3>NetCDF (.nc)<a class="headerlink" href="#netcdf-nc" title="Permalink to this headline">¶</a></h3>
<p>This file contains the up-to-date coordinate variable data for the dataset. This is typically Latitude/Longitude, and Time. For forecasts that are routinely updates, the time variable typically is growing with each update.  This file is updated periodially if the <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> is set to “Keep up to date” or an update is manually triggered via the <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> admin page or API.</p>
</div>
</div>
<div class="section" id="default-layer-settings">
<h2>Default Layer Settings<a class="headerlink" href="#default-layer-settings" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> takes a three tier approach to figure out what the <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, and <code class="docutils literal notranslate"><span class="pre">logscale</span></code> values should be for a request.</p>
<p>In order of precedence:</p>
<ol class="arabic">
<li><dl class="first docutils">
<dt>URL request arguments</dt>
<dd><p class="first last">Always preferred for maximum client control. Controlled with the <code class="docutils literal notranslate"><span class="pre">LOGSCALE</span></code> and <code class="docutils literal notranslate"><span class="pre">COLORSCALERANGE</span></code> URL parameters.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Layer defaults</dt>
<dd><p class="first">Used when populated on a <code class="docutils literal notranslate"><span class="pre">Layer</span></code>. Controlled on each <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> page on a per-variable basis. For each netCDF variable, we look for the following when processing a variable in order of most precedence first:</p>
<blockquote class="last">
<div><ol class="arabic simple">
<li><cite>scale_min</cite> and <cite>scale_max</cite></li>
<li><cite>scale_range</cite></li>
<li><cite>valid_min</cite> and <cite>valid_max</cite></li>
<li><cite>valid_range</cite></li>
</ol>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Global defaults</dt>
<dd><p class="first last">Used when the previous two are not populated. Controlled on the global defaults page on a <code class="docutils literal notranslate"><span class="pre">standard_name</span></code> and <code class="docutils literal notranslate"><span class="pre">units</span></code> basis.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="wms-extensions">
<h2>WMS Extensions<a class="headerlink" href="#wms-extensions" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> implements a number of additional WMS parameters that are not defined in the WMS specification while remaining completely backwards compatible.</p>
<table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-text">WMS Extensions</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="7%" />
<col width="14%" />
<col width="14%" />
<col width="50%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Requests</th>
<th class="head">Possible Values</th>
<th class="head">Usage</th>
<th class="head">Examples</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LOGSCALE</td>
<td>GetLegendGraphic GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>If the request should use logscaling</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>COLORSCALERANGE</td>
<td>GetLegendGraphic GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">[min],[max]</span></code></td>
<td>A tuple in the format [min],[max] that defines the scale range to visualize</td>
<td><code class="docutils literal notranslate"><span class="pre">1,100</span></code>  <code class="docutils literal notranslate"><span class="pre">4.5,30</span></code></td>
</tr>
<tr class="row-even"><td>SHOWLABEL</td>
<td>GetLegendGraphic</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>If the units label should be shows in the legend</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>SHOWVALUES</td>
<td>GetLegendGraphic</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>If the value ticks should be shows in the legend</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-even"><td>COLORBARONLY</td>
<td>GetLegendGraphic</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>If <code class="docutils literal notranslate"><span class="pre">true</span></code>, effectively sets <code class="docutils literal notranslate"><span class="pre">SHOWVALUES</span></code> and <code class="docutils literal notranslate"><span class="pre">SHOWLABEL</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code>. This will override the individual setttings of <code class="docutils literal notranslate"><span class="pre">SHOWVALUES</span></code> and <code class="docutils literal notranslate"><span class="pre">SHOWLABEL</span></code>. No effect if this is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>UNITLABEL</td>
<td>GetLegendGraphic</td>
<td><code class="docutils literal notranslate"><span class="pre">[text]</span></code></td>
<td>Set the unit label on a legend to a custom value</td>
<td><code class="docutils literal notranslate"><span class="pre">meters</span></code> <code class="docutils literal notranslate"><span class="pre">degC</span></code></td>
</tr>
<tr class="row-even"><td>HORIZONTAL</td>
<td>GetLegendGraphic</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
<td>Return a horizontal legend (vertical is the default)</td>
<td><code class="docutils literal notranslate"><span class="pre">true</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code></td>
</tr>
<tr class="row-odd"><td>NUMCONTOURS</td>
<td>GetLegendGraphic GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">[int]</span></code></td>
<td>Return request with the specified number of contours. Only valid for the <code class="docutils literal notranslate"><span class="pre">image_type</span></code> of <code class="docutils literal notranslate"><span class="pre">contours</span></code> or <code class="docutils literal notranslate"><span class="pre">filledcontours</span></code>).</td>
<td><code class="docutils literal notranslate"><span class="pre">8</span></code>  <code class="docutils literal notranslate"><span class="pre">30</span></code></td>
</tr>
<tr class="row-even"><td>STYLE/STYLES</td>
<td>GetLegendGraphic GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">[image_type]_[colormap]</span></code></td>
<td>While some styles are defined in the GetCapabilities document, a use can specify any combination of an <code class="docutils literal notranslate"><span class="pre">image_type</span></code> (<code class="docutils literal notranslate"><span class="pre">filledcontours</span></code>, <code class="docutils literal notranslate"><span class="pre">contours</span></code>, <code class="docutils literal notranslate"><span class="pre">pcolor</span></code>, <code class="docutils literal notranslate"><span class="pre">vectors</span></code>, <code class="docutils literal notranslate"><span class="pre">filledhatches</span></code>, <code class="docutils literal notranslate"><span class="pre">hatches</span></code>) and a matplotlib <code class="docutils literal notranslate"><span class="pre">colormap</span></code> (<a class="reference external" href="http://matplotlib.org/examples/color/colormaps_reference.html">http://matplotlib.org/examples/color/colormaps_reference.html</a>)</td>
<td><code class="docutils literal notranslate"><span class="pre">contours_jet</span></code>  <code class="docutils literal notranslate"><span class="pre">vectors_blues</span></code></td>
</tr>
<tr class="row-odd"><td>VECTORSCALE</td>
<td>GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">[float]</span></code></td>
<td>Controls the scale of vector arrows when plotting a <code class="docutils literal notranslate"><span class="pre">vectors</span></code> style. The <code class="docutils literal notranslate"><span class="pre">vectorscale</span></code> value represents the number of data units per arrow length unit. Smaller numbers lead to longer arrows, while larger numbers represent shorter arrows. This is consistent with the use of the <code class="docutils literal notranslate"><span class="pre">scale</span></code> keyword used by matplotlib (<a class="reference external" href="http://matplotlib.org/api/pyplot_api.html">http://matplotlib.org/api/pyplot_api.html</a>).</td>
<td><code class="docutils literal notranslate"><span class="pre">10.5</span></code> <code class="docutils literal notranslate"><span class="pre">30</span></code></td>
</tr>
<tr class="row-even"><td>VECTORSTEP</td>
<td>GetMap</td>
<td><code class="docutils literal notranslate"><span class="pre">[int]</span></code></td>
<td>Set the number of vector steps to be used when rendering a GetMap request using a <code class="docutils literal notranslate"><span class="pre">vectors</span></code> style. A value of <code class="docutils literal notranslate"><span class="pre">1</span></code> will render with all vectors and is the default behavior.</td>
<td><code class="docutils literal notranslate"><span class="pre">2</span></code> <code class="docutils literal notranslate"><span class="pre">10</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="developers">
<h2>Developers<a class="headerlink" href="#developers" title="Permalink to this headline">¶</a></h2>
<p>To start <code class="docutils literal notranslate"><span class="pre">sci-wms</span></code> with the Django development server on port :7002, type the following commands</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python manage.py runserver <span class="m">0</span>.0.0.0:7002
</pre></div>
</div>
<p>This server is not considered secure for production implementations, and it is recommended you use
an alternative wsgi server like <em>Gunicorn</em>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Topics</a><ul>
<li><a class="reference internal" href="#virtual-layers">Virtual layers</a></li>
<li><a class="reference internal" href="#topology-cache">Topology Cache</a><ul>
<li><a class="reference internal" href="#spatial-tree-idx-and-dat">Spatial Tree (.idx and .dat)</a></li>
<li><a class="reference internal" href="#netcdf-nc">NetCDF (.nc)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-layer-settings">Default Layer Settings</a></li>
<li><a class="reference internal" href="#wms-extensions">WMS Extensions</a></li>
<li><a class="reference internal" href="#developers">Developers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="deployment.html"
                        title="previous chapter">Deployment</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="roadmap.html"
                        title="next chapter">Roadmap</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/advanced.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="roadmap.html" title="Roadmap"
             >next</a> |</li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">sci-wms 2.0.0-dev documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>